<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil | Applora</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <style>
    body { background: linear-gradient(135deg, #f9a8d4, #a78bfa); min-height: 100vh; }
    .post-img { width: 100%; height: 250px; object-fit: cover; transition: transform 0.3s ease; }
    .post-card:hover .post-img { transform: scale(1.05); }
    .post-card { overflow: hidden; border: none; border-radius: 10px; position: relative; }
    .delete-btn { position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(255, 0, 0, 0.8); color: white; border: none; border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s; cursor: pointer; }
    .post-card:hover .delete-btn { opacity: 1; }
    .owner-upload-label:hover .overlay { opacity: 1 !important; }
  </style>
</head>

<body>

  <nav class="navbar navbar-expand-lg navbar-light bg-white bg-opacity-75 shadow-sm mb-4 mx-3 mt-3 rounded-4">
    <div class="container">
      <a class="navbar-brand fw-bold text-primary" href="/feed/{{ visitor_id }}">Applora</a>
      
      <form action="/search" method="get" class="d-flex mx-auto flex-grow-1 px-3" style="max-width: 400px;">
          <input class="form-control rounded-pill border-0 bg-light px-3" type="search" name="q" placeholder="KullanÄ±cÄ± ara..." required>
      </form>
      <div class="d-flex gap-2">
        <a href="/feed/{{ visitor_id }}" class="btn btn-outline-primary btn-sm rounded-pill px-3">Ana Sayfa ğŸ </a>
        <a href="/logout" class="btn btn-outline-danger btn-sm rounded-pill px-3">Ã‡Ä±kÄ±ÅŸ Yap</a>
      </div>
    </div>
  </nav>

  <div class="container pb-5">
    <div class="card shadow-lg border-0 rounded-4 p-4" style="background-color: rgba(255, 255, 255, 0.95);">
      
      <div class="row align-items-center mb-4">
        <div class="col-md-3 text-center position-relative">
          
          {% if is_owner %}
            <form action="/update_profile_image/{{ user.id }}" method="post" enctype="multipart/form-data" id="profileForm">
                <label for="profile_upload" class="d-inline-block position-relative owner-upload-label" style="cursor: pointer;">
                  <img src="{{ user.profile_image or '/static/default.png' }}" alt="Profil FotoÄŸrafÄ±" class="rounded-circle border border-3 border-light shadow-sm" style="width: 150px; height: 150px; object-fit: cover; transition: opacity 0.3s;">
                  <div class="overlay rounded-circle d-flex align-items-center justify-content-center" style="position: absolute; top: 0; left: 0; width: 150px; height: 150px; background: rgba(0,0,0,0.5); opacity: 0; transition: opacity 0.3s;">
                       <span class="text-white fw-bold">ğŸ“· DeÄŸiÅŸtir</span>
                  </div>
                </label>
                <input id="profile_upload" type="file" name="file" accept="image/*" style="display: none;" onchange="this.form.submit()">
            </form>
          {% else %}
            <img src="{{ user.profile_image or '/static/default.png' }}" alt="Profil FotoÄŸrafÄ±" class="rounded-circle border border-3 border-light shadow-sm" style="width: 150px; height: 150px; object-fit: cover;">
          {% endif %}

        </div>
        
        <div class="col-md-9 text-center text-md-start">
          <h2 class="fw-bold mb-1">{{ user.username }}</h2>
          <div class="d-flex gap-3 mb-3 text-secondary">
              <span><b>{{ posts|length }}</b> gÃ¶nderi</span>
              <span><b>{{ followers_count }}</b> takipÃ§i</span>
              <span><b>{{ following_count }}</b> takip</span>
          </div>
          <div class="mt-3">
            
            {% if is_owner %}
                <a href="/upload/{{ user.id }}" class="btn btn-primary px-4 shadow-sm rounded-pill">
                  + Yeni FotoÄŸraf PaylaÅŸ
                </a>

            {% elif visitor_id %}
                {% if is_following %}
                    <form action="/unfollow/{{ user.id }}" method="post" class="d-inline">
                        <input type="hidden" name="current_user_id" value="{{ visitor_id }}">
                        <button type="submit" class="btn btn-outline-secondary px-4 rounded-pill fw-bold">
                            Takipten Ã‡Ä±k
                        </button>
                    </form>
                {% else %}
                    <form action="/follow/{{ user.id }}" method="post" class="d-inline">
                        <input type="hidden" name="current_user_id" value="{{ visitor_id }}">
                        <button type="submit" class="btn btn-primary px-4 rounded-pill fw-bold">
                            Takip Et
                        </button>
                    </form>
                {% endif %}

            {% endif %}
            
          </div>
          <p class="text-muted mb-2">{{ user.email }}</p>
          <small class="text-secondary">ğŸ“… KatÄ±lma tarihi: {{ user.created_at.strftime('%d.%m.%Y') }}</small>
          
          {% if is_owner %}
          <div class="mt-3">
            <a href="/upload/{{ user.id }}" class="btn btn-primary px-4 shadow-sm rounded-pill">+ Yeni FotoÄŸraf PaylaÅŸ</a>
          </div>
          {% endif %}
        </div>
      </div>

      <hr class="text-muted">

      <div class="mt-4">
        <h4 class="mb-4 text-center text-secondary">GÃ¶nderilerim</h4>
        {% if posts %}
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-4">
            {% for post in posts %}
            <div class="col">
              <div class="card h-100 shadow-sm post-card">
                {% if is_owner %}
                <form action="/delete_post/{{ post.id }}" method="post" onsubmit="return confirm('Bu fotoÄŸrafÄ± silmek istediÄŸine emin misin?');">
                    <input type="hidden" name="user_id" value="{{ user.id }}">
                    <button type="submit" class="delete-btn" title="Sil">ğŸ—‘ï¸</button>
                </form>
                {% endif %}
                <img src="{{ post.image_path }}" class="post-img" alt="GÃ¶nderi">
                <div class="card-body">
                  <p class="card-text text-dark">{{ post.caption }}</p>
                </div>
                <div class="card-footer bg-white border-0 text-end">
                   <small class="text-muted" style="font-size: 0.8rem;">{{ post.created_at.strftime('%d %b %Y') }}</small>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="text-center py-5">
            <p class="fs-4 text-muted">HenÃ¼z hiÃ§ fotoÄŸraf paylaÅŸmadÄ±n ğŸ“¸</p>
            {% if is_owner %}
                <p class="text-secondary">Ä°lk anÄ±nÄ± Ã¶lÃ¼msÃ¼zleÅŸtirmek iÃ§in yukarÄ±daki butona tÄ±kla!</p>
            {% else %}
                <p class="text-secondary">Bu kullanÄ±cÄ± henÃ¼z paylaÅŸÄ±m yapmamÄ±ÅŸ.</p>
            {% endif %}
          </div>
        {% endif %}
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>